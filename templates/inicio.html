<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Clientes</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
        }
        h1 {
            text-align: center;
        }
        #filtroNombre {
            margin-bottom: 15px;
            padding: 8px;
            width: 300px;
        }
        table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 15px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #28a745;
            color: white;
        }
        tr:hover {
            background-color: #f5f5f5;
        }
        .btn {
            background-color: #28a745;
            color: white;
            padding: 10px 15px;
            text-decoration: none;
            border-radius: 5px;
            margin-right: 10px;
            display: inline-block;
        }
        .btn:hover {
            background-color: #218838;
        }
        .centrar {
            text-align: center;
        }
    </style>
</head>
<body>
    <h1>Listado de Clientes</h1>

    <div>
        <a href="/nuevo" class="btn">Agregar Nuevo Cliente</a>
        <a href="/logout" class="btn">Cerrar sesión</a>
    </div>

    <label for="filtroNombre">Filtrar por nombre:</label><br>
    <input type="text" id="filtroNombre" placeholder="Escribe el nombre para filtrar...">

    <table id="tablaClientes">
        <thead>
            <tr>
                <th>Fecha</th>
                <th>Nombre</th>
                <th>Monto Prestado</th>
                <th>Deuda Actual</th>
                <th>Observaciones</th>
                <th>Pago</th>
            </tr>
        </thead>
        <tbody>
            {% if clientes|length == 0 %}
            <tr>
                <td colspan="6" class="centrar">No hay clientes registrados.</td>
            </tr>
            {% else %}
            {% for cliente in clientes %}
            <tr>
                <td>{{ cliente['fecha_inicio'] }}</td>
                <td>{{ cliente['nombre'] }}</td>
                <td>{{ cliente['deuda'] + 0 }}</td> <!-- Aquí puedes ajustar si tienes monto prestado distinto -->
                <td>{{ cliente['deuda'] }}</td>
                <td>{{ cliente['observaciones'] }}</td>
                <td>
                    <form action="/pago" method="POST" style="margin:0;">
                        <input type="hidden" name="cliente_id" value="{{ cliente['id'] }}">
                        <input type="number" name="monto" min="0.01" step="0.01" placeholder="Monto pago" required>
                        <input type="submit" value="Registrar pago">
                    </form>
                </td>
            </tr>
            {% endfor %}
            {% endif %}
        </tbody>
    </table>

    <script>
        const filtroInput = document.getElementById('filtroNombre');
        const tabla = document.getElementById('tablaClientes').getElementsByTagName('tbody')[0];

        filtroInput.addEventListener('input', function () {
            const filtro = this.value.toLowerCase();

            let filas = tabla.getElementsByTagName('tr');
            let visibles = 0;

            for (let i = 0; i < filas.length; i++) {
                let nombre = filas[i].getElementsByTagName('td')[1]; // columna nombre
                if (!nombre) continue; // por si no hay td

                if (nombre.textContent.toLowerCase().indexOf(filtro) > -1) {
                    filas[i].style.display = '';
                    visibles++;
                } else {
                    filas[i].style.display = 'none';
                }
            }

            // Si no hay filas visibles, mostrar mensaje
            if (visibles === 0) {
                if (!document.getElementById('noResultados')) {
                    const filaNo = document.createElement('tr');
                    filaNo.id = 'noResultados';
                    filaNo.innerHTML = `<td colspan="6" class="centrar">No hay clientes con ese nombre.</td>`;
                    tabla.appendChild(filaNo);
                }
            } else {
                let noRes = document.getElementById('noResultados');
                if (noRes) noRes.remove();
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Listado de Clientes</title>
    <style>
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 8px; }
        .filtro { margin-bottom: 10px; }
    </style>
    <script>
        function filtrarClientes() {
            let filtro = document.getElementById("filtroNombre").value.toLowerCase();
            let filas = document.querySelectorAll("#tablaClientes tbody tr");
            filas.forEach(fila => {
                let nombre = fila.querySelector(".nombre").textContent.toLowerCase();
                fila.style.display = nombre.includes(filtro) ? "" : "none";
            });
        }
    </script>
</head>
<body>
    <h2>Listado de Clientes</h2>

    <div class="filtro">
        <label for="filtroNombre">Filtrar por nombre:</label><br>
        <input type="text" id="filtroNombre" onkeyup="filtrarClientes()" placeholder="Buscar cliente...">
    </div>

    <a href="/nuevo">âž• Agregar nuevo cliente</a><br><br>

    {% if clientes %}
        <table id="tablaClientes">
            <thead>
                <tr>
                    <th>Fecha Prestada</th>
                    <th>Nombre</th>
                    <th>Monto Prestado</th>
                    <th>Deuda Actual</th>
                    <th>Observaciones</th>
                    <th>Pago</th>
                </tr>
            </thead>
            <tbody>
                {% for cliente in clientes %}
                <tr>
                    <td>{{ cliente.fecha_inicio }}</td>
                    <td class="nombre">{{ cliente.nombre }}</td>
                    <td>{{ "{:,.0f}".format(cliente.monto_prestado).replace(",", ".") }}</td>
                    <td>{{ "{:,.0f}".format(cliente.deuda).replace(",", ".") }}</td>
                    <td>{{ cliente.observaciones }}</td>
                    <td>
                        <form method="POST" action="/registrar_pago">
                            <input type="hidden" name="cliente_id" value="{{ cliente.id }}">
                            <input type="number" name="pago" placeholder="Pago" step="0.01" required>
                            <button type="submit">ðŸ’¸</button>
                        </form>
                        <form method="GET" action="/pagos/{{ cliente.id }}">
                            <button type="submit">ðŸ“… Ver pagos</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    {% else %}
        <p>No hay clientes registrados.</p>
    {% endif %}

    <br>
    <a href="/logout">Cerrar sesiÃ³n</a>
</body>
</html>
